<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Keskonmanj">
<title>Keskonmanj</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Crimson+Pro:ital,wght@0,300;0,400;0,600;1,300;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
/* â”€â”€ RESET & ROOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root{
  --cream:#F5EFE0;--warm-white:#FDFAF4;--terracotta:#C4602A;
  --terracotta-light:#E8865A;--dark:#1A1208;--brown:#5C3D1E;
  --wood:#8B5E3C;--wood-light:#C49A6C;--sage:#7A8C6E;--gold:#D4A843;
  --border:#D4C4A0;--rust:#A0522D;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html{font-size:16px;}
body{
  background:var(--cream);color:var(--dark);
  font-family:'DM Sans',sans-serif;min-height:100vh;
  -webkit-font-smoothing:antialiased;overflow-x:hidden;
}

/* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
header{
  background:linear-gradient(135deg,#3D2B1F 0%,#5C3D1E 40%,#4A3728 70%,#6B4C35 100%);
  color:var(--cream);
  padding: calc(1.2rem + var(--safe-top)) 1.2rem 1.2rem;
  display:flex;align-items:center;justify-content:space-between;
  border-bottom:3px solid var(--terracotta);position:relative;overflow:hidden;
  position:sticky;top:0;z-index:100;
}
header::after{
  content:'';position:absolute;bottom:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,var(--terracotta),var(--gold),var(--terracotta));
}
.logo-wrap{display:flex;align-items:center;gap:.9rem;position:relative;z-index:1;}
.logo-icon{width:44px;height:44px;flex-shrink:0;filter:drop-shadow(0 2px 6px rgba(0,0,0,.4));}
.logo-text-wrap{display:flex;flex-direction:column;}
.logo{font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:3px;color:var(--cream);line-height:1;text-shadow:2px 2px 0 rgba(0,0,0,.3);}
.logo span{color:var(--terracotta-light);}
.subtitle{font-family:'Crimson Pro',serif;font-size:.75rem;color:var(--wood-light);letter-spacing:1.5px;font-style:italic;margin-top:1px;}
.save-badge{
  background:var(--sage);color:white;font-size:.7rem;padding:.3rem .75rem;
  border-radius:999px;display:none;align-items:center;gap:.3rem;
  animation:pulse 2s ease infinite;
}
.save-badge.visible{display:flex;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:.7;}}

/* â”€â”€ APP CONTAINER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.app{
  max-width:680px;margin:0 auto;
  padding:1.5rem max(1rem, var(--safe-left)) calc(2rem + var(--safe-bottom)) max(1rem, var(--safe-right));
}

/* â”€â”€ SECTION TITLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section-title{font-family:'Crimson Pro',serif;font-size:1.4rem;font-weight:600;color:var(--brown);margin-bottom:.3rem;}
.section-sub{font-size:.82rem;color:var(--sage);margin-bottom:1.2rem;}

/* â”€â”€ RESTORED BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.saved-banner{
  background:var(--brown);color:var(--cream);border-radius:12px;
  padding:.9rem 1.2rem;margin-bottom:1.5rem;display:none;
  align-items:center;justify-content:space-between;gap:1rem;
}
.saved-banner.visible{display:flex;}
.saved-banner-text{font-size:.85rem;}
.saved-banner-text strong{font-family:'Crimson Pro',serif;font-size:1rem;display:block;margin-bottom:2px;}
.restore-btn{
  padding:.45rem 1rem;background:var(--terracotta);color:white;border:none;
  border-radius:8px;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.82rem;
  white-space:nowrap;-webkit-appearance:none;min-height:44px;
}

/* â”€â”€ FOYER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.foyer-section{
  background:var(--warm-white);border:1.5px solid var(--border);
  border-radius:14px;padding:1.4rem;margin-bottom:1.5rem;
}
.foyer-grid{display:grid;grid-template-columns:1fr;gap:1.2rem;margin-top:.8rem;}
.foyer-field label{
  display:block;font-size:.75rem;font-weight:500;letter-spacing:1.5px;
  text-transform:uppercase;color:#374151;margin-bottom:.45rem;
}
.foyer-field select{
  width:100%;padding:.75rem 1rem;border:1.5px solid var(--border);border-radius:8px;
  font-family:'DM Sans',sans-serif;font-size:1rem;color:var(--dark);background:white;
  -webkit-appearance:none;outline:none;min-height:44px;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%235C3D1E' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 1rem center;padding-right:2.5rem;
}
.foyer-field select:focus{border-color:var(--terracotta);}
.allergies-grid{display:flex;flex-wrap:wrap;gap:.4rem;margin-top:.5rem;}
.allergy-btn{
  padding:.45rem .8rem;border:1.5px solid var(--border);border-radius:999px;
  background:white;font-family:'DM Sans',sans-serif;font-size:.8rem;color:var(--brown);
  cursor:pointer;-webkit-appearance:none;min-height:36px;transition:all .2s;
  user-select:none;-webkit-user-select:none;
}
.allergy-btn.active{background:var(--rust);border-color:var(--rust);color:white;}

/* â”€â”€ THEMES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.themes-grid{display:flex;flex-wrap:wrap;gap:.6rem;margin-bottom:1.5rem;}
.theme-btn{
  display:flex;align-items:center;gap:.4rem;padding:.55rem 1rem;
  border:2px solid var(--border);border-radius:999px;background:var(--warm-white);
  cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.88rem;color:var(--brown);
  transition:all .2s;-webkit-appearance:none;min-height:40px;
  user-select:none;-webkit-user-select:none;
  touch-action:manipulation;
}
.theme-btn.selected{background:var(--terracotta);border-color:var(--terracotta);color:white;}
.selected-count{font-size:.82rem;color:var(--sage);margin-bottom:1.2rem;}
.selected-count strong{color:var(--terracotta);}

/* â”€â”€ GENERATE BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.generate-btn{
  display:block;width:100%;padding:1rem;
  background:linear-gradient(135deg,var(--brown),var(--wood));
  color:white;border:none;border-radius:12px;
  font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:2px;
  cursor:pointer;transition:all .2s;margin-bottom:2rem;
  -webkit-appearance:none;min-height:52px;
}
.generate-btn:disabled{opacity:.4;}
.generate-btn:not(:disabled):active{transform:scale(.98);}

/* â”€â”€ LOADING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.loading{display:none;text-align:center;padding:2.5rem;font-family:'Crimson Pro',serif;font-size:1.1rem;color:var(--brown);font-style:italic;}
.loading.visible{display:block;}
.dots::after{content:'...';animation:dots 1.2s steps(4,end) infinite;}
@keyframes dots{0%,20%{content:'.'}40%{content:'..'}60%,100%{content:'...'}}

/* â”€â”€ RESULTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#results{display:none;}
#results.visible{display:block;animation:fadeIn .4s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1}}

/* â”€â”€ WEEK HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.week-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem;gap:.5rem;}
.legend{display:flex;flex-direction:column;gap:.3rem;font-size:.75rem;}
.legend-item{display:flex;align-items:center;gap:.35rem;color:var(--brown);}
.legend-dot{width:10px;height:10px;border-radius:2px;flex-shrink:0;}
.legend-dot.lunch{background:var(--terracotta-light);}
.legend-dot.dinner{background:var(--sage);}

/* â”€â”€ DAYS â€” MOBILE: vertical list, not 7-col grid â”€â”€â”€â”€â”€â”€â”€â”€ */
.days-list{display:flex;flex-direction:column;gap:.75rem;margin-bottom:2rem;}
.day-card{
  background:var(--warm-white);border:1.5px solid var(--border);
  border-radius:12px;overflow:hidden;
}
.day-name{
  background:linear-gradient(135deg,var(--wood),var(--wood-light));
  color:white;padding:.45rem 1rem;font-family:'Bebas Neue',sans-serif;
  font-size:.9rem;letter-spacing:2px;
}
.day-meals{padding:.6rem .75rem;display:grid;grid-template-columns:1fr 1fr;gap:.5rem;}
.meal-item{
  padding:.6rem .75rem;border-radius:8px;font-size:.82rem;line-height:1.35;
  cursor:pointer;-webkit-tap-highlight-color:rgba(196,96,42,.15);
  position:relative;transition:transform .15s;
  min-height:70px;
}
.meal-item:active{transform:scale(.97);}
.meal-item.lunch{background:#FFF3E8;border-left:3px solid var(--terracotta-light);}
.meal-item.dinner{background:#EEF2EC;border-left:3px solid var(--sage);}
.meal-label{font-size:.62rem;text-transform:uppercase;letter-spacing:1px;color:var(--sage);font-weight:500;margin-bottom:3px;}
.meal-name{color:var(--dark);font-weight:500;font-size:.8rem;}
.meal-theme-tag{display:inline-block;font-size:.6rem;background:var(--cream);color:var(--brown);border-radius:3px;padding:1px 5px;margin-top:3px;}
.meal-item.has-warning::after{content:'âš ï¸';position:absolute;top:4px;right:4px;font-size:.7rem;}

/* â”€â”€ RECIPE MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal-overlay{
  position:fixed;inset:0;background:rgba(26,18,8,.8);z-index:1000;
  display:flex;align-items:flex-end;justify-content:center;
  opacity:0;pointer-events:none;transition:opacity .3s;
}
.modal-overlay.open{opacity:1;pointer-events:all;}
.modal{
  background:var(--warm-white);border-radius:20px 20px 0 0;
  width:100%;max-height:90vh;overflow-y:auto;
  transform:translateY(100%);transition:transform .35s cubic-bezier(.34,1.1,.64,1);
  padding-bottom:calc(1.5rem + var(--safe-bottom));
  /* smooth iOS scroll */
  -webkit-overflow-scrolling:touch;
}
.modal-overlay.open .modal{transform:translateY(0);}
.modal-handle{width:40px;height:4px;background:var(--border);border-radius:999px;margin:12px auto 4px;}
.modal-header{
  background:linear-gradient(135deg,#3D2B1F,#5C3D1E);color:var(--cream);
  padding:1.4rem 1.5rem 1.2rem;position:sticky;top:0;z-index:2;
}
.modal-tag{font-size:.65rem;letter-spacing:2px;text-transform:uppercase;color:var(--wood-light);margin-bottom:.4rem;}
.modal-title{font-family:'Crimson Pro',serif;font-size:1.5rem;font-weight:600;line-height:1.2;}
.modal-meta{display:flex;flex-wrap:wrap;gap:.75rem;margin-top:.6rem;font-size:.78rem;color:var(--wood-light);}
.modal-close{
  position:absolute;top:1rem;right:1rem;background:rgba(255,255,255,.15);border:none;
  color:var(--cream);width:36px;height:36px;border-radius:50%;cursor:pointer;
  font-size:1.1rem;display:flex;align-items:center;justify-content:center;
}
.modal-body{padding:1.4rem 1.5rem;}
.modal-note{
  background:#FFF3E8;border:1.5px solid var(--terracotta-light);border-radius:8px;
  padding:.6rem 1rem;font-size:.82rem;color:var(--brown);margin-bottom:1rem;
}
.modal-note.warning{background:#FEE2E2;border-color:#F87171;color:#991B1B;}
.recipe-section-title{
  font-size:.7rem;font-weight:600;letter-spacing:2px;text-transform:uppercase;
  color:var(--terracotta);margin-bottom:.8rem;padding-bottom:.4rem;
  border-bottom:1.5px solid var(--border);
}
.ingredients-grid{display:grid;grid-template-columns:1fr 1fr;gap:.35rem;margin-bottom:1.5rem;}
@media(max-width:380px){.ingredients-grid{grid-template-columns:1fr;}}
.ingredient-row{
  display:flex;align-items:center;justify-content:space-between;
  padding:.4rem .65rem;background:var(--cream);border-radius:6px;font-size:.83rem;gap:.4rem;
}
.ingredient-qty{color:var(--sage);font-size:.76rem;white-space:nowrap;}
.steps-list{display:flex;flex-direction:column;gap:.85rem;}
.step{display:flex;gap:.9rem;align-items:flex-start;padding:.85rem;background:var(--cream);border-radius:10px;}
.step-num{
  min-width:26px;height:26px;background:var(--terracotta);color:white;
  border-radius:50%;display:flex;align-items:center;justify-content:center;
  font-size:.76rem;font-weight:600;flex-shrink:0;
}
.step-text{font-size:.86rem;line-height:1.6;padding-top:2px;}
.chef-tip{
  margin-top:1.3rem;padding:.9rem 1.1rem;
  background:linear-gradient(135deg,#FFF3E8,#FDFAF4);
  border:1.5px solid var(--terracotta-light);border-radius:10px;
  font-size:.84rem;line-height:1.5;
}
.chef-tip strong{color:var(--terracotta);display:block;margin-bottom:.3rem;font-size:.73rem;letter-spacing:1px;text-transform:uppercase;}

/* â”€â”€ COURSES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.courses-section{
  background:var(--warm-white);border:1.5px solid var(--border);
  border-radius:14px;padding:1.4rem;margin-bottom:1.5rem;
}
.courses-title{font-family:'Crimson Pro',serif;font-size:1.3rem;font-weight:600;color:var(--brown);margin-bottom:1.2rem;}
.courses-grid{display:grid;grid-template-columns:1fr;gap:1.2rem;}
@media(min-width:500px){.courses-grid{grid-template-columns:1fr 1fr;}}
.course-category{background:var(--cream);border-radius:10px;padding:.9rem;}
.cat-title{font-size:.72rem;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--terracotta);margin-bottom:.65rem;padding-bottom:.4rem;border-bottom:1.5px solid var(--border);}
.course-item{display:flex;align-items:center;justify-content:space-between;padding:.32rem 0;font-size:.84rem;border-bottom:1px dotted var(--border);gap:.5rem;}
.course-item:last-child{border-bottom:none;}
.course-name{flex:1;color:var(--dark);}
.course-qty{font-size:.74rem;color:var(--sage);white-space:nowrap;}

/* â”€â”€ ACTION BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.action-bar{display:grid;grid-template-columns:1fr 1fr;gap:.6rem;margin-bottom:1.4rem;}
.action-btn{
  padding:.75rem .8rem;border-radius:10px;border:2px solid var(--border);
  background:white;font-family:'DM Sans',sans-serif;font-size:.85rem;cursor:pointer;
  color:var(--brown);transition:all .15s;display:flex;align-items:center;justify-content:center;
  gap:.35rem;min-height:44px;-webkit-appearance:none;
}
.action-btn.primary{background:var(--sage);border-color:var(--sage);color:white;}
.action-btn.share{background:linear-gradient(135deg,#25D366,#128C7E);color:white;border-color:transparent;}
.action-btn.danger{border-color:#D4A0A0;color:#9B3A3A;}
.action-btn:active{transform:scale(.96);}

/* â”€â”€ SHARE BOTTOM SHEET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.share-overlay{
  position:fixed;inset:0;background:rgba(26,18,8,.75);z-index:2000;
  display:flex;align-items:flex-end;justify-content:center;
  opacity:0;pointer-events:none;transition:opacity .3s;
}
.share-overlay.open{opacity:1;pointer-events:all;}
.share-sheet{
  background:var(--warm-white);border-radius:20px 20px 0 0;
  width:100%;max-width:520px;
  padding:1.2rem 1.2rem calc(1.5rem + var(--safe-bottom));
  transform:translateY(100%);transition:transform .35s cubic-bezier(.34,1.2,.64,1);
}
.share-overlay.open .share-sheet{transform:translateY(0);}
.share-handle{width:40px;height:4px;background:var(--border);border-radius:999px;margin:0 auto 1rem;}
.share-title{font-family:'Crimson Pro',serif;font-size:1.2rem;font-weight:600;color:var(--brown);text-align:center;margin-bottom:.25rem;}
.share-sub{font-size:.78rem;color:var(--sage);text-align:center;margin-bottom:1.2rem;}
.share-options{display:grid;grid-template-columns:repeat(3,1fr);gap:.6rem;margin-bottom:.9rem;}
.share-opt{
  display:flex;flex-direction:column;align-items:center;gap:.4rem;padding:.9rem .4rem;
  border:1.5px solid var(--border);border-radius:12px;cursor:pointer;background:white;
  font-family:'DM Sans',sans-serif;font-size:.76rem;color:var(--brown);text-align:center;
  transition:all .2s;-webkit-appearance:none;min-height:44px;
}
.share-opt:active{background:#FFF6EE;border-color:var(--terracotta);transform:scale(.96);}
.share-opt-icon{font-size:1.6rem;line-height:1;}
.share-copy-row{display:flex;gap:.5rem;margin-top:.6rem;}
.share-copy-input{
  flex:1;padding:.7rem 1rem;border:1.5px solid var(--border);border-radius:8px;
  font-size:.8rem;color:var(--dark);background:var(--cream);outline:none;
  font-family:'DM Sans',sans-serif;
}
.share-copy-btn{
  padding:.7rem .9rem;background:var(--terracotta);color:white;border:none;border-radius:8px;
  cursor:pointer;font-size:.82rem;font-family:'DM Sans',sans-serif;white-space:nowrap;
  -webkit-appearance:none;min-height:44px;
}
.share-close-btn{
  display:block;width:100%;margin-top:.9rem;padding:.75rem;background:var(--cream);
  border:1.5px solid var(--border);border-radius:10px;cursor:pointer;
  font-family:'DM Sans',sans-serif;font-size:.88rem;color:var(--brown);
  -webkit-appearance:none;min-height:44px;
}

/* â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toast{
  position:fixed;bottom:calc(1.5rem + var(--safe-bottom));left:50%;
  transform:translateX(-50%) translateY(100px);
  background:var(--dark);color:var(--cream);padding:.75rem 1.4rem;
  border-radius:999px;font-size:.88rem;z-index:9999;
  transition:transform .4s cubic-bezier(.34,1.56,.64,1);
  box-shadow:0 8px 30px rgba(0,0,0,.3);white-space:nowrap;
}
.toast.show{transform:translateX(-50%) translateY(0);}

/* â”€â”€ DIVIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.divider{border:none;border-top:2px solid var(--border);margin:1.5rem 0;}

/* â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
footer{
  background:linear-gradient(135deg,#2C1F15,#3D2B1F);color:var(--wood-light);
  text-align:center;padding:1.2rem 1rem calc(1.2rem + var(--safe-bottom));
  font-size:.75rem;border-top:3px solid var(--terracotta);margin-top:2rem;
}
footer a{color:var(--gold);text-decoration:none;}
.footer-logo{font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:3px;color:var(--cream);margin-bottom:.3rem;}

/* â”€â”€ PRINT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media print{
  header .header-right,.themes-section,.foyer-section,.generate-btn,
  .action-bar,.modal-overlay,.share-overlay,footer{display:none!important;}
  #results{display:block!important;}
  body{background:white;}
}
</style>
</head>
<body>

<!-- RECIPE MODAL -->
<div class="modal-overlay" id="recipeOverlay">
  <div class="modal" id="recipeModal">
    <div class="modal-handle"></div>
    <div class="modal-header">
      <div class="modal-tag" id="modalTag"></div>
      <div class="modal-title" id="modalTitle"></div>
      <div class="modal-meta" id="modalMeta"></div>
      <button class="modal-close" id="btnCloseRecipe" aria-label="Fermer">âœ•</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<!-- SHARE BOTTOM SHEET -->
<div class="share-overlay" id="shareOverlay">
  <div class="share-sheet" id="shareSheet">
    <div class="share-handle"></div>
    <div class="share-title">ğŸ“¤ Partager la liste de courses</div>
    <div class="share-sub">Envoie ta liste Ã  toute la famille</div>
    <div class="share-options">
      <button class="share-opt" id="sWhatsapp"><span class="share-opt-icon">ğŸ’¬</span>WhatsApp</button>
      <button class="share-opt" id="sSms"><span class="share-opt-icon">ğŸ“±</span>SMS</button>
      <button class="share-opt" id="sEmail"><span class="share-opt-icon">âœ‰ï¸</span>E-mail</button>
      <button class="share-opt" id="sTelegram"><span class="share-opt-icon">âœˆï¸</span>Telegram</button>
      <button class="share-opt" id="sNative"><span class="share-opt-icon">ğŸ”—</span>Partagerâ€¦</button>
      <button class="share-opt" id="sPrint"><span class="share-opt-icon">ğŸ–¨ï¸</span>Imprimer</button>
    </div>
    <div class="share-copy-row">
      <input class="share-copy-input" id="shareCopyInput" readonly placeholder="Votre listeâ€¦">
      <button class="share-copy-btn" id="sCopy">ğŸ“‹ Copier</button>
    </div>
    <button class="share-close-btn" id="btnCloseShare">âœ• Fermer</button>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- HEADER -->
<header>
  <div class="logo-wrap">
    <svg class="logo-icon" viewBox="0 0 58 58" fill="none" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="27" cy="36" rx="20" ry="14" fill="#8B5E3C" stroke="#C49A6C" stroke-width="1.5"/>
      <ellipse cx="27" cy="36" rx="17" ry="11" fill="#A0522D"/>
      <ellipse cx="22" cy="30" rx="5" ry="3" fill="rgba(255,255,255,0.12)" transform="rotate(-15 22 30)"/>
      <rect x="44" y="33" width="13" height="5" rx="2.5" fill="#6B7280" stroke="#9CA3AF" stroke-width="1"/>
      <circle cx="46" cy="35.5" r="1.2" fill="#374151"/><circle cx="54" cy="35.5" r="1.2" fill="#374151"/>
      <path d="M18 20 Q20 15 18 10" stroke="#C49A6C" stroke-width="1.5" stroke-linecap="round" fill="none" opacity="0.7"/>
      <path d="M26 18 Q28 12 26 7" stroke="#C49A6C" stroke-width="1.5" stroke-linecap="round" fill="none" opacity="0.7"/>
      <path d="M34 20 Q36 15 34 10" stroke="#C49A6C" stroke-width="1.5" stroke-linecap="round" fill="none" opacity="0.7"/>
      <line x1="6" y1="8" x2="6" y2="50" stroke="#9CA3AF" stroke-width="2.5" stroke-linecap="round"/>
      <path d="M6 8 Q10 12 8 28 L6 28Z" fill="#6B7280"/>
      <rect x="4" y="38" width="4" height="10" rx="2" fill="#8B5E3C" stroke="#C49A6C" stroke-width="0.8"/>
    </svg>
    <div class="logo-text-wrap">
      <div class="logo">Keskon<span>manj</span></div>
      <div class="subtitle">Planificateur Â· 7 jours</div>
    </div>
  </div>
  <div class="header-right">
    <div class="save-badge" id="saveBadge">ğŸ’¾ SauvegardÃ©</div>
  </div>
</header>

<div class="app">
  <div class="saved-banner" id="savedBanner">
    <div class="saved-banner-text">
      <strong>ğŸ“… Semaine sauvegardÃ©e !</strong>
      Restaure ta semaine prÃ©cÃ©dente.
    </div>
    <button class="restore-btn" id="btnRestore">ğŸ”„ Restaurer</button>
  </div>

  <div class="foyer-section">
    <div class="section-title">Ton foyer</div>
    <div class="section-sub">Adapte les quantitÃ©s et les recettes</div>
    <div class="foyer-grid">
      <div class="foyer-field">
        <label>ğŸ‘¥ Nombre de personnes</label>
        <select id="nbPersonnes">
          <option value="1">1 personne</option>
          <option value="2" selected>2 personnes</option>
          <option value="3">3 personnes</option>
          <option value="4">4 personnes</option>
          <option value="5">5 personnes</option>
          <option value="6">6 personnes et +</option>
        </select>
      </div>
      <div class="foyer-field">
        <label>âš ï¸ Allergies & intolÃ©rances</label>
        <div class="allergies-grid" id="allergiesGrid"></div>
      </div>
    </div>
  </div>

  <div class="section-title">ThÃ¨mes de la semaine</div>
  <div class="section-sub">SÃ©lectionne 2 Ã  4 thÃ¨mes pour tes 14 repas</div>
  <div class="themes-grid" id="themesGrid"></div>
  <div class="selected-count" id="selectedCount"><strong>0</strong> thÃ¨me(s) â€” choisis entre 2 et 4</div>
  <button class="generate-btn" id="btnGenerate" disabled>ğŸ½ï¸ GÃ©nÃ©rer ma semaine</button>

  <div class="loading" id="loading">Le chef prÃ©pare ta semaine<span class="dots"></span></div>

  <div id="results">
    <div class="week-header">
      <div>
        <div class="section-title">ğŸ“… Ta semaine</div>
        <div class="section-sub" style="margin-bottom:0">Appuie sur un repas pour la recette</div>
      </div>
      <div class="legend">
        <div class="legend-item"><div class="legend-dot lunch"></div>DÃ©jeuner</div>
        <div class="legend-item"><div class="legend-dot dinner"></div>DÃ®ner</div>
      </div>
    </div>
    <div class="days-list" id="daysGrid"></div>
    <hr class="divider">
    <div class="courses-section">
      <div class="courses-title">ğŸ›’ Liste de courses</div>
      <div class="action-bar">
        <button class="action-btn primary" id="btnSave">ğŸ’¾ Sauvegarder</button>
        <button class="action-btn share" id="btnShare">ğŸ“¤ Partager</button>
        <button class="action-btn" id="btnPrint">ğŸ–¨ï¸ Imprimer</button>
        <button class="action-btn danger" id="btnClear">ğŸ—‘ï¸ Effacer</button>
      </div>
      <div class="courses-grid" id="coursesGrid"></div>
    </div>
  </div>
</div>

<footer>
  <div class="footer-logo">Keskonmanj</div>
  <p>Â© 2026 â€” PropriÃ©tÃ© exclusive de <a href="#">fluide.cmpny</a>. Tous droits rÃ©servÃ©s.</p>
</footer>

<script>
// ============================================================
// STORAGE â€” Safari-safe (localStorage with graceful fallback)
// ============================================================
var _memStore = {};
var Storage = {
  get: function(k) {
    try { return localStorage.getItem(k); } catch(e) { return _memStore[k] || null; }
  },
  set: function(k, v) {
    try { localStorage.setItem(k, v); } catch(e) { _memStore[k] = v; }
  },
  remove: function(k) {
    try { localStorage.removeItem(k); } catch(e) { delete _memStore[k]; }
  }
};

// ============================================================
// DATA
// ============================================================
var ALLERGIES = [
  {id:'gluten',label:'ğŸŒ¾ Gluten'},{id:'lactose',label:'ğŸ¥› Lactose'},
  {id:'oeuf',label:'ğŸ¥š Å’ufs'},{id:'poisson',label:'ğŸŸ Poisson'},
  {id:'crustaces',label:'ğŸ¦ CrustacÃ©s'},{id:'noix',label:'ğŸ¥œ Fruits Ã  coques'},
  {id:'soja',label:'ğŸ«˜ Soja'},{id:'porc',label:'ğŸ· Porc'},
  {id:'vegetarien',label:'ğŸ¥¦ VÃ©gÃ©tarien'},{id:'vegan',label:'ğŸŒ± Vegan'},
];
var ALLERGEN_MAP = {
  gluten:['pÃ¢tes','pain','spaghetti','penne','tagliatelle','linguine','naan','chapati','bun','toast','croque','quiche','tarte','gnocchi','farine','ramen','nouilles','soba','crÃªpe','galette','pizza','quesadilla','nachos','empanadas','samoussas','wrap','kebab','bÃ¶rek','panini'],
  lactose:['fromage','crÃ¨me','beurre','lait','mozzarella','parmesan','comtÃ©','gruyÃ¨re','cheddar','feta','chÃ¨vre','reblochon','ricotta','burrata','fondue','raclette','tartiflette','gratin','carbonara','quiche','risotto','bÃ©chamel','yaourt','halloumi'],
  oeuf:['Å“uf','omelette','carbonara','quiche','frittata','shakshuka','crÃªpe','pancake','soufflÃ©','galette'],
  poisson:['saumon','thon','cabillaud','sardine','hareng','dorade','poisson','anchois','morue'],
  crustaces:['crevettes','moules','palourdes','poulpe','saint-jacques','bisque','fruits de mer','vongole','gambas'],
  noix:['cacahuÃ¨tes','noix','amandes','noisettes','pistaches','sÃ©same','tahini','arachides','mafÃ©'],
  soja:['soja','tofu','miso','edamame'],
  porc:['lardons','jambon','saucisse','chorizo','andouillette','porc','hot-dog','cassoulet','potÃ©e'],
  vegetarien:['poulet','bÅ“uf','veau','agneau','dinde','porc','lardons','jambon','saucisse','chorizo','saumon','thon','cabillaud','crevettes','moules','anchois','sardine','canard','gambas'],
  vegan:['poulet','bÅ“uf','veau','agneau','dinde','porc','lardons','jambon','saucisse','chorizo','saumon','thon','crevettes','moules','anchois','Å“uf','fromage','crÃ¨me','beurre','lait','mozzarella','parmesan','feta','chÃ¨vre','ricotta','yaourt','halloumi','canard'],
};

var THEMES = [
  {id:'asiatique',label:'Asiatique',emoji:'ğŸ¥¢'},{id:'mediterrane',label:'MÃ©diterranÃ©en',emoji:'ğŸ«’'},
  {id:'gourmand',label:'Gourmand & rÃ©confort',emoji:'ğŸ§€'},{id:'proteine',label:'ProtÃ©inÃ© & sport',emoji:'ğŸ’ª'},
  {id:'fastfood',label:'Fast-food maison',emoji:'ğŸ”'},{id:'veggie',label:'VÃ©gÃ©tarien',emoji:'ğŸ¥¦'},
  {id:'francais',label:'Cuisine franÃ§aise',emoji:'ğŸ¥'},{id:'rapide',label:'Rapide (< 20 min)',emoji:'âš¡'},
  {id:'exotique',label:'Exotique & Ã©picÃ©',emoji:'ğŸŒ¶ï¸'},{id:'marmite',label:'Plats mijotÃ©s',emoji:'ğŸ«•'},
  {id:'brunch',label:'Brunch & Å“ufs',emoji:'ğŸ³'},{id:'mer',label:'Fruits de mer & poisson',emoji:'ğŸŸ'},
  {id:'batch',label:'Batch cooking',emoji:'ğŸ“¦'},{id:'saison',label:'De saison',emoji:'ğŸŒ¿'},
  {id:'worldstreet',label:'Street food monde',emoji:'ğŸŒ'},{id:'salades',label:'Grandes salades-repas',emoji:'ğŸ¥—'},
  {id:'soupe',label:'Soupes & veloutÃ©s',emoji:'ğŸ²'},{id:'plancha',label:'Plancha & grill',emoji:'ğŸ”¥'},
];

var DAYS = ['Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi','Dimanche'];

var MEAL_DB = {
  asiatique:{
    dejeuner:[
      {name:'Bol de ramen poulet-miso',tag:'Asiatique'},{name:'Wok de bÅ“uf sautÃ© aux lÃ©gumes',tag:'Asiatique'},
      {name:'Poulet teriyaki & riz jasmin',tag:'Asiatique'},{name:'Soupe pho bÅ“uf-herbes',tag:'Asiatique'},
      {name:'Riz cantonnais Å“uf-jambon',tag:'Asiatique'},{name:'Curry vert thaÃ¯ au tofu',tag:'Asiatique'},
      {name:'Gyozas poÃªlÃ©s porc-gingembre',tag:'Asiatique'},
    ],
    diner:[
      {name:'Pad thaÃ¯ aux crevettes',tag:'Asiatique'},{name:'Salade de nouilles soba froides',tag:'Asiatique'},
      {name:'Soupe tom kha champignons',tag:'Asiatique'},{name:'Riz sautÃ© lÃ©gumes-sauce soja',tag:'Asiatique'},
      {name:'Nems maison sauce nuoc-mÃ¢m',tag:'Asiatique'},{name:'Bibimbap vÃ©gÃ©tarien',tag:'Asiatique'},
      {name:'Poulet au lait de coco-basilic thaÃ¯',tag:'Asiatique'},
    ],
  },
  mediterrane:{
    dejeuner:[
      {name:'Salade grecque-feta',tag:'MÃ©diterranÃ©en'},{name:'Risotto citron-parmesan',tag:'MÃ©diterranÃ©en'},
      {name:'Pasta tomates cerises-burrata',tag:'MÃ©diterranÃ©en'},{name:'Tajine poulet-citron confit-olives',tag:'MÃ©diterranÃ©en'},
      {name:'Salade niÃ§oise thon-anchois',tag:'MÃ©diterranÃ©en'},{name:'Moussaka agneau-aubergines',tag:'MÃ©diterranÃ©en'},
      {name:'Bol falafel-houmous-lÃ©gumes',tag:'MÃ©diterranÃ©en'},
    ],
    diner:[
      {name:'Soupe minestrone aux lÃ©gumes',tag:'MÃ©diterranÃ©en'},{name:'Bruschetta tomates-mozzarella',tag:'MÃ©diterranÃ©en'},
      {name:'Poivrons farcis riz-agneau',tag:'MÃ©diterranÃ©en'},{name:'Penne Ã  l\'arrabbiata',tag:'MÃ©diterranÃ©en'},
      {name:'Houmous maison & cruditÃ©s pita',tag:'MÃ©diterranÃ©en'},{name:'Gratin de courgettes feta-menthe',tag:'MÃ©diterranÃ©en'},
      {name:'Poisson en papillote olives-thym',tag:'MÃ©diterranÃ©en'},
    ],
  },
  gourmand:{
    dejeuner:[
      {name:'Gratin dauphinois & jambon cru',tag:'Gourmand'},{name:'Quiche lorraine maison',tag:'Gourmand'},
      {name:'Croque-monsieur faÃ§on croque-chef',tag:'Gourmand'},{name:'Risotto chorizo-Ã©pinards',tag:'Gourmand'},
      {name:'Tartiflette express au reblochon',tag:'Gourmand'},{name:'PÃ¢tes carbonara Ã  la franÃ§aise',tag:'Gourmand'},
      {name:'Burger maison fromage-oignons caramÃ©lisÃ©s',tag:'Gourmand'},
    ],
    diner:[
      {name:'Soupe Ã  l\'oignon gratinÃ©e',tag:'Gourmand'},{name:'Omelette baveuse champignons-comtÃ©',tag:'Gourmand'},
      {name:'Toast chÃ¨vre chaud-miel-noix',tag:'Gourmand'},{name:'Gnocchis poÃªlÃ©s beurre-sauge-parmesan',tag:'Gourmand'},
      {name:'PoÃªlÃ©e pommes de terre-lardons',tag:'Gourmand'},{name:'Fondue au fromage pain de campagne',tag:'Gourmand'},
      {name:'Raclette light solo',tag:'Gourmand'},
    ],
  },
  proteine:{
    dejeuner:[
      {name:'Poulet grillÃ© riz brun-brocolis',tag:'Sport'},{name:'Salade CÃ©sar thon-Å“uf dur',tag:'Sport'},
      {name:'Blanc de dinde poÃªlÃ©-quinoa-Ã©pinards',tag:'Sport'},{name:'Steak hachÃ© maison-patate douce',tag:'Sport'},
      {name:'Bol protÃ©inÃ© avocat-pois chiches-poulet',tag:'Sport'},{name:'Saumon grillÃ© lentilles-lÃ©gumes',tag:'Sport'},
      {name:'Omelette jambon-champignons',tag:'Sport'},
    ],
    diner:[
      {name:'VeloutÃ© potimarron-lait de coco',tag:'Sport'},{name:'Salade lentilles-feta-noix',tag:'Sport'},
      {name:'Escalope de veau citron-cÃ¢pres',tag:'Sport'},{name:'Poisson vapeur haricots verts',tag:'Sport'},
      {name:'Soupe miso tofu soyeux',tag:'Sport'},{name:'Cottage cheese-cruditÃ©s-pain complet',tag:'Sport'},
      {name:'Edamame-riz complet-saumon fumÃ©',tag:'Sport'},
    ],
  },
  fastfood:{
    dejeuner:[
      {name:'Smash burger double fromage',tag:'Fast-food'},{name:'Hot-dog maison moutarde-oignons',tag:'Fast-food'},
      {name:'Wraps poulet-cheddar-salade',tag:'Fast-food'},{name:'Kebab maison sauce blanche',tag:'Fast-food'},
      {name:'Pizza maison margherita-roquette',tag:'Fast-food'},{name:'Tacos mexicain poulet-guacamole',tag:'Fast-food'},
      {name:'Burger vÃ©gÃ© halloumi-avocat',tag:'Fast-food'},
    ],
    diner:[
      {name:'Nuggets poulet maison-frites four',tag:'Fast-food'},{name:'Quesadillas fromage-haricots',tag:'Fast-food'},
      {name:'Pizza blanche ricotta-champignons',tag:'Fast-food'},{name:'Club sandwich toastÃ© jambon-Å“uf',tag:'Fast-food'},
      {name:'Nachos haricots-fromage-guac',tag:'Fast-food'},{name:'Naan-pizza chorizo-mozzarella',tag:'Fast-food'},
      {name:'Panini thon-mozzarella-tomates',tag:'Fast-food'},
    ],
  },
  veggie:{
    dejeuner:[
      {name:'Curry de pois chiches-Ã©pinards',tag:'VÃ©gÃ©tarien'},{name:'Tarte aux poireaux-brebis',tag:'VÃ©gÃ©tarien'},
      {name:'Salade quinoa-betterave-noix-chÃ¨vre',tag:'VÃ©gÃ©tarien'},{name:'Risotto champignons-parmesan',tag:'VÃ©gÃ©tarien'},
      {name:'Bowl riz-lÃ©gumes rÃ´tis-tahini',tag:'VÃ©gÃ©tarien'},{name:'Galettes de lÃ©gumes sauce yaourt',tag:'VÃ©gÃ©tarien'},
      {name:'Gnocchi Ã©pinards-ricotta',tag:'VÃ©gÃ©tarien'},
    ],
    diner:[
      {name:'Soupe de lentilles-cumin-citron',tag:'VÃ©gÃ©tarien'},{name:'Å’ufs brouillÃ©s champignons-ciboulette',tag:'VÃ©gÃ©tarien'},
      {name:'VeloutÃ© de courgette-basilic',tag:'VÃ©gÃ©tarien'},{name:'Tartelette tomates-moutarde-herbes',tag:'VÃ©gÃ©tarien'},
      {name:'RÃ¶stis de courgettes-feta',tag:'VÃ©gÃ©tarien'},{name:'Soupe potiron-graines de courge',tag:'VÃ©gÃ©tarien'},
      {name:'Avocat farci quinoa-citron-herbes',tag:'VÃ©gÃ©tarien'},
    ],
  },
  francais:{
    dejeuner:[
      {name:'Pot-au-feu lÃ©gumes-bÅ“uf',tag:'FranÃ§ais'},{name:'Blanquette de veau riz crÃ©ole',tag:'FranÃ§ais'},
      {name:'BÅ“uf bourguignon express',tag:'FranÃ§ais'},{name:'Poulet rÃ´ti flageolets-ail',tag:'FranÃ§ais'},
      {name:'Salade de gÃ©siers confits-noix',tag:'FranÃ§ais'},{name:'Steak frites sauce au poivre',tag:'FranÃ§ais'},
      {name:'Navarin d\'agneau printanier',tag:'FranÃ§ais'},
    ],
    diner:[
      {name:'Vichyssoise froide poireaux',tag:'FranÃ§ais'},{name:'SoufflÃ© au comtÃ©',tag:'FranÃ§ais'},
      {name:'Gratin de chou-fleur bÃ©chamel',tag:'FranÃ§ais'},{name:'Salade lyonnaise lardons-Å“uf pochÃ©',tag:'FranÃ§ais'},
      {name:'CrÃªpes salÃ©es jambon-champignons',tag:'FranÃ§ais'},{name:'PissaladiÃ¨re oignons-anchois',tag:'FranÃ§ais'},
      {name:'Veau Marengo & tagliatelles',tag:'FranÃ§ais'},
    ],
  },
  rapide:{
    dejeuner:[
      {name:'PÃ¢tes ail-huile-parmesan',tag:'Rapide'},{name:'Sandwich jambon-beurre-cornichons',tag:'Rapide'},
      {name:'Salade composÃ©e thon-maÃ¯s-tomate',tag:'Rapide'},{name:'Omelette jambon-gruyÃ¨re',tag:'Rapide'},
      {name:'Toast avocat-Å“uf pochÃ©',tag:'Rapide'},{name:'Poulet marinÃ© express & salade',tag:'Rapide'},
      {name:'Bol de cÃ©rÃ©ales lÃ©gumes rÃ´tis',tag:'Rapide'},
    ],
    diner:[
      {name:'Soupe lÃ©gumes surgelÃ©s-vermicelles',tag:'Rapide'},{name:'Tartines chÃ¨vre-miel-poire',tag:'Rapide'},
      {name:'Yaourt grec-granola-miel',tag:'Rapide'},{name:'Å’ufs Ã  la coque & mouillettes',tag:'Rapide'},
      {name:'Salade tomates-mozzarella',tag:'Rapide'},{name:'Soupe express miso-tofu',tag:'Rapide'},
      {name:'Pain perdu salÃ© jambon-herbes',tag:'Rapide'},
    ],
  },
  exotique:{
    dejeuner:[
      {name:'MafÃ© sÃ©nÃ©galais poulet-arachides',tag:'Exotique'},{name:'Rendang bÅ“uf indonÃ©sien',tag:'Exotique'},
      {name:'Jerk chicken jamaÃ¯cain & riz haricots',tag:'Exotique'},{name:'Dhal de lentilles rouges-naan',tag:'Exotique'},
      {name:'Shakshuka Å“ufs-tomates-harissa',tag:'Exotique'},{name:'Empanadas thon-olives au four',tag:'Exotique'},
      {name:'Pho bo vietnamien maison',tag:'Exotique'},
    ],
    diner:[
      {name:'Soupe tom yam aux crevettes',tag:'Exotique'},{name:'TabulÃ© persil-menthe-boulgour',tag:'Exotique'},
      {name:'Tortilla espagnole pomme de terre',tag:'Exotique'},{name:'Samoussas lÃ©gumes-curry four',tag:'Exotique'},
      {name:'Gaspacho andalou bien frais',tag:'Exotique'},{name:'Foul mÃ©damÃ¨s-ail-citron',tag:'Exotique'},
      {name:'Chapati-dhal express',tag:'Exotique'},
    ],
  },
  marmite:{
    dejeuner:[
      {name:'Osso buco milanaise-gremolata',tag:'MijotÃ©'},{name:'Poulet basquaise sauce piment',tag:'MijotÃ©'},
      {name:'Coq au vin blanc-champignons',tag:'MijotÃ©'},{name:'Tajine agneau-pruneaux-amandes',tag:'MijotÃ©'},
      {name:'Joue de porc carottes-cÃ©leri',tag:'MijotÃ©'},{name:'Saucisse-lentilles du Puy',tag:'MijotÃ©'},
      {name:'Daube provenÃ§ale olives-herbes',tag:'MijotÃ©'},
    ],
    diner:[
      {name:'VeloutÃ© poireaux-pommes de terre',tag:'MijotÃ©'},{name:'Ratatouille au four provenÃ§ale',tag:'MijotÃ©'},
      {name:'Cassoulet rapide haricots blancs',tag:'MijotÃ©'},{name:'PotÃ©e auvergnate chou-saucisse',tag:'MijotÃ©'},
      {name:'Gratin de crozets beaufortain',tag:'MijotÃ©'},{name:'Soupe paysanne orge-lÃ©gumes',tag:'MijotÃ©'},
      {name:'Soupe de chÃ¢taignes-lard fumÃ©',tag:'MijotÃ©'},
    ],
  },
  brunch:{
    dejeuner:[
      {name:'Å’ufs BÃ©nÃ©dicte sauce hollandaise',tag:'Brunch'},{name:'Pancakes beurre-sirop d\'Ã©rable',tag:'Brunch'},
      {name:'Shakshuka poivrons-feta',tag:'Brunch'},{name:'Avocado toast Å“uf pochÃ©-sÃ©same',tag:'Brunch'},
      {name:'Omelette roulÃ©e jambon-herbes',tag:'Brunch'},{name:'CrÃªpes salÃ©es Ã©pinards-saumon fumÃ©',tag:'Brunch'},
      {name:'Bagel saumon fumÃ©-cream cheese',tag:'Brunch'},
    ],
    diner:[
      {name:'Frittata lÃ©gumes du frigo',tag:'Brunch'},{name:'Galette sarrasin jambon-Å“uf-fromage',tag:'Brunch'},
      {name:'Pain dorÃ© salÃ© chÃ¨vre-miel-romarin',tag:'Brunch'},{name:'VeloutÃ© d\'asperges Å“uf mollet',tag:'Brunch'},
      {name:'Tarte fine poireaux-saumon fumÃ©',tag:'Brunch'},{name:'Bowl aÃ§aÃ¯-granola-banane-myrtilles',tag:'Brunch'},
      {name:'Tartines nordiques hareng marinÃ©-betterave',tag:'Brunch'},
    ],
  },
  mer:{
    dejeuner:[
      {name:'Moules mariniÃ¨res frites maison',tag:'Mer'},{name:'Dos de cabillaud beurre blanc-cÃ¢pres',tag:'Mer'},
      {name:'Salade crevettes avocat-pamplemousse',tag:'Mer'},{name:'Linguine aux vongole',tag:'Mer'},
      {name:'Tataki de thon sÃ©same-ponzu',tag:'Mer'},{name:'Risotto aux fruits de mer',tag:'Mer'},
      {name:'Saumon mi-cuit croÃ»te sÃ©same-miso',tag:'Mer'},
    ],
    diner:[
      {name:'VeloutÃ© bisque de crevettes',tag:'Mer'},{name:'Tartare saumon-avocat-citron vert',tag:'Mer'},
      {name:'Sardines grillÃ©es citron-persil',tag:'Mer'},{name:'Soupe de poisson rouille-croÃ»tons',tag:'Mer'},
      {name:'Saint-Jacques poÃªlÃ©es purÃ©e cÃ©leri',tag:'Mer'},{name:'Crevettes ail-beurre-persil',tag:'Mer'},
      {name:'Carpaccio de dorade-huile d\'olive',tag:'Mer'},
    ],
  },
  batch:{
    dejeuner:[
      {name:'Bol quinoa-lÃ©gumes rÃ´tis-pois chiches',tag:'Batch'},{name:'Wrap poulet rÃ´ti-cruditÃ©s',tag:'Batch'},
      {name:'Riz complet lentilles-carottes-cumin',tag:'Batch'},{name:'Salade batch haricots-Å“uf-thon',tag:'Batch'},
      {name:'Gratin de lÃ©gumes prÃ©parÃ© d\'avance',tag:'Batch'},{name:'Soupe batch 5 lÃ©gumes',tag:'Batch'},
      {name:'PÃ¢tes froides pesto-tomates sÃ©chÃ©es-mozzarella',tag:'Batch'},
    ],
    diner:[
      {name:'Soupe de lÃ©gumes batch du dimanche',tag:'Batch'},{name:'Riz sautÃ© restes poulet-lÃ©gumes',tag:'Batch'},
      {name:'Bowl froid quinoa-avocat-tahini',tag:'Batch'},{name:'Tartines houmous-lÃ©gumes batch',tag:'Batch'},
      {name:'Omelette restes lÃ©gumes rÃ´tis',tag:'Batch'},{name:'Salade lentilles-herbes-vinaigrette',tag:'Batch'},
      {name:'PurÃ©e pois chiches Ã©picÃ©e-cruditÃ©s',tag:'Batch'},
    ],
  },
  saison:{
    dejeuner:[
      {name:'VeloutÃ© cÃ©leri-rave-pomme verte',tag:'De saison'},{name:'Endives braisÃ©es jambon-bÃ©chamel',tag:'De saison'},
      {name:'Tarte tatin endives-chÃ¨vre-noix',tag:'De saison'},{name:'Poireaux fondants vinaigrette-Å“uf mimosa',tag:'De saison'},
      {name:'Risotto topinambour-noisettes-parmesan',tag:'De saison'},{name:'Gratin chou blanc lardons-comtÃ©',tag:'De saison'},
      {name:'Salade mÃ¢che betterave-noix-chÃ¨vre chaud',tag:'De saison'},
    ],
    diner:[
      {name:'Soupe potimarron-gingembre-coco',tag:'De saison'},{name:'Salade mÃ¢che-poire-noix-roquefort',tag:'De saison'},
      {name:'VeloutÃ© poireaux-pomme de terre',tag:'De saison'},{name:'RÃ¶stis de cÃ©leri-rave sauce moutarde',tag:'De saison'},
      {name:'Soupe au chou vert-saucisse fumÃ©e',tag:'De saison'},{name:'Betterave rÃ´tie four-feta-miel',tag:'De saison'},
      {name:'Gratin courge butternut-gruyÃ¨re',tag:'De saison'},
    ],
  },
  worldstreet:{
    dejeuner:[
      {name:'Tacos al pastor porc-ananas',tag:'Street food'},{name:'BÃ¡nh mÃ¬ poulet-pickles-coriandre',tag:'Street food'},
      {name:'Falafel pita-houmous-tahini',tag:'Street food'},{name:'Okonomiyaki japonais chou-porc',tag:'Street food'},
      {name:'Arepas maÃ¯s-poulet-avocat',tag:'Street food'},{name:'BÃ¶rek turc Ã©pinards-feta',tag:'Street food'},
      {name:'Dosa crÃªpe indienne-chutney coco',tag:'Street food'},
    ],
    diner:[
      {name:'Gyozas poÃªlÃ©s-vapeur sauce ponzu',tag:'Street food'},{name:'GÃ¶zleme turc fromage-Ã©pinards',tag:'Street food'},
      {name:'Samosas lÃ©gumes-menthe chutney',tag:'Street food'},{name:'Tteokbokki gÃ¢teaux de riz Ã©picÃ©s',tag:'Street food'},
      {name:'Momo tibÃ©tain vapeur-bÅ“uf',tag:'Street food'},{name:'Elotes maÃ¯s grillÃ©-mayo-fromage',tag:'Street food'},
      {name:'PÃ£o de queijo brÃ©silien fromage',tag:'Street food'},
    ],
  },
  salades:{
    dejeuner:[
      {name:'Salade CÃ©sar poulet grillÃ©-croÃ»tons',tag:'Salade-repas'},{name:'Bowl thaÃ¯ bÅ“uf-mangue-cacahuÃ¨tes',tag:'Salade-repas'},
      {name:'NiÃ§oise thon-haricots verts-anchois',tag:'Salade-repas'},{name:'Fattoush libanais-pain grillÃ©-sumac',tag:'Salade-repas'},
      {name:'Salade mexicaine poulet-haricots noirs',tag:'Salade-repas'},{name:'Salade boulgour-lÃ©gumes rÃ´tis-halloumi',tag:'Salade-repas'},
      {name:'Salade poulpe grillÃ©-pommes de terre',tag:'Salade-repas'},
    ],
    diner:[
      {name:'Salade lentilles beluga-betterave-chÃ¨vre',tag:'Salade-repas'},{name:'Panzanella tomates-pain-basilic',tag:'Salade-repas'},
      {name:'Salade kale-quinoa-grenade',tag:'Salade-repas'},{name:'Salade nordique saumon-pomme-aneth',tag:'Salade-repas'},
      {name:'Salade orzo-courgettes-feta-menthe',tag:'Salade-repas'},{name:'Waldorf revisitÃ©e poulet-cÃ©leri-noix',tag:'Salade-repas'},
      {name:'Salade riz complet-thon-herbes',tag:'Salade-repas'},
    ],
  },
  soupe:{
    dejeuner:[
      {name:'Soupe pois cassÃ©s-lard fumÃ©',tag:'Soupe'},{name:'VeloutÃ© carottes-coco-gingembre',tag:'Soupe'},
      {name:'Minestrone complet pÃ¢tes-lÃ©gumes',tag:'Soupe'},{name:'Ramen maison poulet-champignons-nori',tag:'Soupe'},
      {name:'Harira marocaine agneau-pois chiches',tag:'Soupe'},{name:'Soupe tomates rÃ´ties-basilic',tag:'Soupe'},
      {name:'Goulash hongroise bÅ“uf-paprika',tag:'Soupe'},
    ],
    diner:[
      {name:'VeloutÃ© champignons-crÃ¨me-cerfeuil',tag:'Soupe'},{name:'Soupe Ã  l\'ail-pain-huile d\'olive',tag:'Soupe'},
      {name:'Pho vÃ©gÃ©tarien champignons-tofu',tag:'Soupe'},{name:'Soupe haricots blancs-romarin',tag:'Soupe'},
      {name:'Gazpacho betterave-yaourt-aneth',tag:'Soupe'},{name:'Soupe miso renforcÃ©e tofu-lÃ©gumes',tag:'Soupe'},
      {name:'Bouillon thaÃ¯ crevettes-citronnelle',tag:'Soupe'},
    ],
  },
  plancha:{
    dejeuner:[
      {name:'Magret de canard plancha-figues',tag:'Plancha'},{name:'Crevettes plancha ail-beurre-citron',tag:'Plancha'},
      {name:'CÃ´te de porc plancha-moutarde-thym',tag:'Plancha'},{name:'LÃ©gumes grillÃ©s plancha-houmous',tag:'Plancha'},
      {name:'Saumon plancha sauce teriyaki-sÃ©same',tag:'Plancha'},{name:'Poulet marinÃ© citron-herbes plancha',tag:'Plancha'},
      {name:'Calamars plancha ail-persil-citron',tag:'Plancha'},
    ],
    diner:[
      {name:'Halloumi grillÃ©-tomates-olives',tag:'Plancha'},{name:'Gambas flambÃ©es cognac-beurre',tag:'Plancha'},
      {name:'LÃ©gumes saison grillÃ©s-pesto',tag:'Plancha'},{name:'Brochettes poulet-poivrons sauce yaourt',tag:'Plancha'},
      {name:'Saint-Jacques plancha-beurre blanc',tag:'Plancha'},{name:'Tomates farcies grillÃ©es plancha',tag:'Plancha'},
      {name:'Ananas grillÃ© coco-rhum-vanille',tag:'Plancha'},
    ],
  },
};

// ============================================================
// RECIPE DB (subset â€” principaux plats)
// ============================================================
var RECIPE_DB = {
  'Salade grecque-feta':{temps:'10 min',difficulte:'Facile',baseIngredients:[{name:'Tomates',q:2,u:'grosses'},{name:'Concombre',q:.5,u:''},{name:'Feta',q:80,u:'g'},{name:'Olives noires',q:40,u:'g'},{name:'Oignon rouge',q:.25,u:''},{name:'Huile d\'olive',q:2,u:'c.Ã  s.'},{name:'Origan sÃ©chÃ©',q:.5,u:'c.Ã  c.'},{name:'Citron',q:.5,u:''}],steps:['Couper les tomates en quartiers et le concombre en demi-rondelles.','Ã‰mincer finement l\'oignon rouge.','Disposer tous les lÃ©gumes dans un plat. Ajouter les olives.','Ã‰mietter grossiÃ¨rement la feta par-dessus.','Arroser d\'huile d\'olive et de jus de citron.','Saupoudrer d\'origan. Servir immÃ©diatement.'],tip:'Ne mÃ©langez pas â€” la salade grecque authentique se dresse en couches.'},
  'Pasta tomates cerises-burrata':{temps:'15 min',difficulte:'Facile',baseIngredients:[{name:'PÃ¢tes',q:100,u:'g'},{name:'Tomates cerises',q:150,u:'g'},{name:'Burrata',q:.5,u:'boule'},{name:'Ail',q:1,u:'gousse'},{name:'Basilic frais',q:5,u:'feuilles'},{name:'Huile d\'olive',q:2,u:'c.Ã  s.'},{name:'Piment en flocons',q:1,u:'pincÃ©e'}],steps:['Cuire les pÃ¢tes al dente. RÃ©server une louche d\'eau de cuisson.','Chauffer l\'huile, faire revenir l\'ail Ã©mincÃ© 1 min.','Ajouter les tomates cerises, cuire 6 min en les Ã©crasant lÃ©gÃ¨rement.','Ajouter une pincÃ©e de piment. Verser les pÃ¢tes avec un peu d\'eau de cuisson.','MÃ©langer 1 min Ã  feu vif.','Dresser avec la burrata au centre et les feuilles de basilic.'],tip:'L\'eau de cuisson fÃ©culente lie la sauce et la fait adhÃ©rer aux pÃ¢tes.'},
  'Poulet teriyaki & riz jasmin':{temps:'20 min',difficulte:'Facile',baseIngredients:[{name:'Filet de poulet',q:180,u:'g'},{name:'Sauce soja',q:3,u:'c.Ã  s.'},{name:'Miel',q:1.5,u:'c.Ã  s.'},{name:'Vinaigre de riz',q:1,u:'c.Ã  s.'},{name:'Riz jasmin',q:80,u:'g'},{name:'Ail',q:1,u:'gousse'},{name:'Gingembre rÃ¢pÃ©',q:1,u:'c.Ã  c.'},{name:'Graines de sÃ©same',q:.5,u:'c.Ã  c.'}],steps:['Cuire le riz selon le paquet.','MÃ©langer sauce soja, miel, vinaigre, ail et gingembre.','Couper le poulet en tranches. Saisir Ã  feu vif 3-4 min de chaque cÃ´tÃ©.','Verser la sauce teriyaki, laisser caramÃ©liser 2-3 min.','Servir sur le riz, parsemer de sÃ©same et ciboule.'],tip:'Ne lÃ©sinez pas sur la chaleur au dÃ©part â€” la croÃ»te caramÃ©lisÃ©e est l\'Ã¢me du teriyaki.'},
  'Smash burger double fromage':{temps:'15 min',difficulte:'Facile',baseIngredients:[{name:'BÅ“uf hachÃ© 15%MG',q:200,u:'g'},{name:'Cheddar tranchÃ©',q:2,u:'tranches'},{name:'Bun briochÃ©',q:1,u:''},{name:'Oignon',q:.5,u:''},{name:'Cornichons',q:5,u:''},{name:'Ketchup',q:1,u:'c.Ã  s.'},{name:'Moutarde',q:1,u:'c.Ã  c.'}],steps:['CaramÃ©liser l\'oignon Ã©mincÃ© 7 min au beurre Ã  feu doux.','Diviser la viande en deux boules. Ne pas trop travailler.','Chauffer la poÃªle en fonte Ã  feu trÃ¨s vif.','Poser une boule et aplatir fort immÃ©diatement. Saler. Cuire 1 min 30.','Retourner, poser le cheddar, couvrir 30 sec. RÃ©pÃ©ter.','Toaster le bun. Monter : ketchup, oignons, cornichons, steaks, moutarde.'],tip:'La poÃªle doit vraiment fumer â€” c\'est la rÃ©action de Maillard qui crÃ©e la croÃ»te signature.'},
  'Quiche lorraine maison':{temps:'50 min',difficulte:'Moyen',baseIngredients:[{name:'PÃ¢te brisÃ©e',q:.25,u:'rouleau'},{name:'Lardons fumÃ©s',q:100,u:'g'},{name:'Å’ufs',q:2,u:''},{name:'CrÃ¨me fraÃ®che Ã©paisse',q:150,u:'ml'},{name:'GruyÃ¨re rÃ¢pÃ©',q:50,u:'g'},{name:'Noix de muscade',q:1,u:'pincÃ©e'}],steps:['PrÃ©chauffer le four Ã  180Â°C. Foncer un moule avec la pÃ¢te.','Faire revenir les lardons Ã  sec. Ã‰goutter.','Battre les Å“ufs avec la crÃ¨me, la muscade, sel et poivre.','Cuire la pÃ¢te Ã  blanc 10 min avec poids. Enlever les poids.','RÃ©partir les lardons, verser l\'appareil, parsemer de gruyÃ¨re.','Cuire 25-30 min. Le centre doit Ãªtre encore lÃ©gÃ¨rement tremblotant.'],tip:'L\'appareil tremblotant en sortie de four est normal â€” il finit de cuire et reste moelleux.'},
  'Curry de pois chiches-Ã©pinards':{temps:'20 min',difficulte:'Facile',baseIngredients:[{name:'Pois chiches en boÃ®te',q:200,u:'g'},{name:'Ã‰pinards frais',q:100,u:'g'},{name:'Tomates concassÃ©es',q:200,u:'g'},{name:'Lait de coco',q:100,u:'ml'},{name:'Oignon',q:1,u:''},{name:'Ail',q:2,u:'gousses'},{name:'Garam masala',q:1,u:'c.Ã  c.'},{name:'Riz basmati',q:80,u:'g'}],steps:['Cuire le riz basmati selon le paquet.','Faire revenir l\'oignon Ã©mincÃ© 5 min. Ajouter l\'ail et les Ã©pices, cuire 1 min.','Ajouter les tomates concassÃ©es, cuire 5 min.','Verser le lait de coco et les pois chiches Ã©gouttÃ©s. Mijoter 8 min.','Ajouter les Ã©pinards, mÃ©langer jusqu\'Ã  ce qu\'ils tombent.','Servir sur le riz avec yaourt grec et coriandre.'],tip:'Ajoutez une c.Ã  c. de jus de citron en fin â€” l\'aciditÃ© rÃ©veille tous les arÃ´mes du curry.'},
  'Risotto citron-parmesan':{temps:'30 min',difficulte:'Moyen',baseIngredients:[{name:'Riz Arborio',q:80,u:'g'},{name:'Bouillon de lÃ©gumes chaud',q:500,u:'ml'},{name:'Parmesan rÃ¢pÃ©',q:50,u:'g'},{name:'Beurre',q:30,u:'g'},{name:'Oignon',q:.5,u:''},{name:'Vin blanc sec',q:80,u:'ml'},{name:'Citron (zeste + jus)',q:.5,u:''},{name:'Huile d\'olive',q:1,u:'c.Ã  s.'}],steps:['Faire suer l\'oignon dans l\'huile et la moitiÃ© du beurre 4 min.','Ajouter le riz et nacrer 2 min en remuant.','DÃ©glacer au vin blanc. Remuer jusqu\'Ã  absorption complÃ¨te.','Ajouter le bouillon louche par louche en remuant, 18 min.','Hors du feu, incorporer beurre, parmesan, zeste et jus de citron.','Couvrir 2 min puis servir dans des assiettes creuses chaudes.'],tip:'La mantecatura (beurre + parmesan hors du feu) est le secret du risotto crÃ©meux.'},
  'Shakshuka Å“ufs-tomates-harissa':{temps:'25 min',difficulte:'Facile',baseIngredients:[{name:'Å’ufs',q:2,u:''},{name:'Tomates concassÃ©es',q:400,u:'g'},{name:'Poivron rouge',q:1,u:''},{name:'Oignon',q:1,u:''},{name:'Harissa',q:1,u:'c.Ã  c.'},{name:'Cumin & paprika',q:1,u:'c.Ã  c.'},{name:'Ail',q:2,u:'gousses'},{name:'Coriandre fraÃ®che',q:1,u:'bouquet'}],steps:['Faire revenir l\'oignon et le poivron en dÃ©s 5 min.','Ajouter l\'ail, le cumin, le paprika et la harissa. Cuire 1 min.','Verser les tomates. Cuire 10 min jusqu\'Ã  sauce Ã©paissie.','CrÃ©er des niches dans la sauce, casser les Å“ufs dedans.','Couvrir et cuire 5-7 min â€” blanc pris, jaune coulant.','Parsemer de coriandre et servir avec pain pita chaud.'],tip:'Surveillez les Å“ufs Ã  partir de 5 min â€” jaune encore tremblotant = parfait.'},
  'PÃ¢tes carbonara Ã  la franÃ§aise':{temps:'20 min',difficulte:'Moyen',baseIngredients:[{name:'Spaghetti',q:100,u:'g'},{name:'Lardons fumÃ©s',q:80,u:'g'},{name:'Å’ufs',q:2,u:''},{name:'Parmesan ou gruyÃ¨re rÃ¢pÃ©',q:50,u:'g'},{name:'CrÃ¨me fraÃ®che',q:2,u:'c.Ã  s.'},{name:'Poivre noir',q:1,u:'pincÃ©e gÃ©nÃ©reuse'},{name:'Ail',q:1,u:'gousse'}],steps:['Cuire les spaghetti al dente. RÃ©server une grande tasse d\'eau de cuisson.','Faire revenir les lardons et l\'ail sans ajout de matiÃ¨re grasse.','MÃ©langer dans un bol : Å“ufs entiers, crÃ¨me, fromage, poivre noir gÃ©nÃ©reux.','Ã‰goutter les pÃ¢tes, les jeter dans la poÃªle avec les lardons hors du feu.','Verser le mÃ©lange Å“uf-crÃ¨me en mÃ©langeant vigoureusement. Ajouter de l\'eau de cuisson.','Le mÃ©lange doit Ãªtre crÃ©meux â€” jamais brouillÃ©.'],tip:'Hors du feu est la rÃ¨gle d\'or â€” la chaleur rÃ©siduelle suffit.'},
  'Toast avocat-Å“uf pochÃ©':{temps:'12 min',difficulte:'Facile',baseIngredients:[{name:'Pain complet ou seigle',q:2,u:'tranches'},{name:'Avocat mÃ»r',q:1,u:''},{name:'Å’uf',q:1,u:''},{name:'Citron',q:.25,u:''},{name:'Piment en flocons',q:1,u:'pincÃ©e'},{name:'Graines de sÃ©same',q:.5,u:'c.Ã  c.'},{name:'Fleur de sel',q:1,u:'pincÃ©e'}],steps:['Toaster le pain.','Ã‰craser l\'avocat avec jus de citron, sel et poivre. Garder de la texture.','Porter de l\'eau Ã  frÃ©missement avec un filet de vinaigre. CrÃ©er un tourbillon.','Casser l\'Å“uf dans un petit bol, glisser doucement dans l\'eau. Cuire 3 min. Ã‰goutter.','Ã‰taler l\'avocat sur le toast.','Poser l\'Å“uf pochÃ©, parsemer de sÃ©same, piment et fleur de sel.'],tip:'L\'Å“uf pochÃ© parfait : blanc entiÃ¨rement pris, jaune encore coulant. Comptez 3 minutes chrono.'},
  'Salade CÃ©sar poulet grillÃ©-croÃ»tons':{temps:'20 min',difficulte:'Facile',baseIngredients:[{name:'Filet de poulet',q:150,u:'g'},{name:'Laitue romaine',q:.5,u:''},{name:'CroÃ»tons Ã  l\'ail',q:30,u:'g'},{name:'Parmesan',q:25,u:'g'},{name:'Mayonnaise',q:1,u:'c.Ã  s.'},{name:'Anchois',q:1,u:'filet'},{name:'Ail',q:.5,u:'gousse'},{name:'Jus de citron',q:1,u:'c.Ã  s.'}],steps:['Assaisonner le poulet. Cuire Ã  la poÃªle 5-6 min de chaque cÃ´tÃ©. Laisser reposer 3 min puis trancher.','PrÃ©parer la sauce CÃ©sar : mayo, anchois Ã©crasÃ©, ail rÃ¢pÃ©, citron, sel, poivre.','DÃ©chirer la romaine en morceaux.','MÃ©langer la romaine avec la sauce CÃ©sar.','Dresser avec les tranches de poulet, les croÃ»tons et les copeaux de parmesan.','Poivrer gÃ©nÃ©reusement au moulin.'],tip:'L\'anchois dans la sauce CÃ©sar est indispensable â€” il donne l\'umami qui rend la sauce addictive.'},
  'Moules mariniÃ¨res frites maison':{temps:'25 min',difficulte:'Facile',baseIngredients:[{name:'Moules fraÃ®ches',q:500,u:'g'},{name:'Vin blanc sec',q:150,u:'ml'},{name:'Ã‰chalotes',q:2,u:''},{name:'Ail',q:1,u:'gousse'},{name:'Persil plat',q:.5,u:'bouquet'},{name:'Beurre',q:30,u:'g'},{name:'Pommes de terre',q:250,u:'g'}],steps:['Gratter et laver les moules. Jeter celles ouvertes qui ne se ferment pas.','Faire revenir Ã©chalotes et ail dans le beurre 2 min. Verser le vin blanc.','Verser les moules, couvrir et cuire Ã  feu vif 3-5 min jusqu\'Ã  ouverture.','Cuire les pommes de terre en frites au four 200Â°C 20 min.','Parsemer les moules de persil hachÃ©. Jeter celles restÃ©es fermÃ©es.','Servir avec les frites et pain de campagne.'],tip:'Les moules doivent Ãªtre fermÃ©es avant cuisson et ouvertes aprÃ¨s.'},
};

// ============================================================
// STATE
// ============================================================
var activeAllergies = new Set();
var selectedThemes = new Set();
var currentLunches = [];
var currentDinners = [];
var currentCourses = {};

// ============================================================
// HELPERS
// ============================================================
function mealHasAllergen(name) {
  if (!activeAllergies.size) return false;
  var lc = name.toLowerCase();
  for (var a of activeAllergies) {
    var kw = ALLERGEN_MAP[a] || [];
    if (kw.some(function(k){ return lc.includes(k.toLowerCase()); })) return true;
  }
  return false;
}
function shuffle(arr) { return arr.slice().sort(function(){ return Math.random() - .5; }); }
function showToast(msg) {
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(function(){ t.classList.remove('show'); }, 3000);
}

// ============================================================
// RENDER ALLERGIES + THEMES
// ============================================================
function renderAllergies() {
  var grid = document.getElementById('allergiesGrid');
  ALLERGIES.forEach(function(a) {
    var btn = document.createElement('button');
    btn.className = 'allergy-btn';
    btn.textContent = a.label;
    btn.addEventListener('click', function() {
      if (activeAllergies.has(a.id)) { activeAllergies.delete(a.id); btn.classList.remove('active'); }
      else { activeAllergies.add(a.id); btn.classList.add('active'); }
    });
    grid.appendChild(btn);
  });
}

function renderThemes() {
  var grid = document.getElementById('themesGrid');
  THEMES.forEach(function(t) {
    var btn = document.createElement('button');
    btn.className = 'theme-btn';
    btn.innerHTML = '<span>' + t.emoji + '</span> ' + t.label;
    btn.addEventListener('click', function() {
      if (selectedThemes.has(t.id)) { selectedThemes.delete(t.id); btn.classList.remove('selected'); }
      else {
        if (selectedThemes.size >= 4) { showToast('âš ï¸ Maximum 4 thÃ¨mes'); return; }
        selectedThemes.add(t.id); btn.classList.add('selected');
      }
      var c = selectedThemes.size;
      document.getElementById('selectedCount').innerHTML = '<strong>' + c + '</strong> thÃ¨me(s) â€” choisis entre 2 et 4';
      document.getElementById('btnGenerate').disabled = c < 2;
    });
    grid.appendChild(btn);
  });
}

// ============================================================
// GENERATE WEEK
// ============================================================
function pickMeals(themes, slot) {
  var result = [];
  var perTheme = Math.ceil(7 / themes.length);
  themes.forEach(function(t) {
    var pool = shuffle(MEAL_DB[t] && MEAL_DB[t][slot] ? MEAL_DB[t][slot] : []);
    pool.slice(0, perTheme).forEach(function(m){ result.push(m); });
  });
  return shuffle(result).slice(0, 7);
}

function generate() {
  if (selectedThemes.size < 2) return;
  document.getElementById('loading').classList.add('visible');
  document.getElementById('results').classList.remove('visible');
  setTimeout(function() {
    var themes = Array.from(selectedThemes);
    currentLunches = pickMeals(themes, 'dejeuner');
    currentDinners = pickMeals(themes, 'diner');
    renderWeek(currentLunches, currentDinners);
    var p = document.getElementById('nbPersonnes').value;
    currentCourses = generateCourses(currentLunches.concat(currentDinners), p);
    renderCourses(currentCourses);
    document.getElementById('loading').classList.remove('visible');
    document.getElementById('results').classList.add('visible');
    document.getElementById('results').scrollIntoView({ behavior:'smooth', block:'start' });
  }, 800);
}

function renderWeek(lunches, dinners) {
  var dg = document.getElementById('daysGrid');
  dg.innerHTML = '';
  DAYS.forEach(function(day, i) {
    var l = lunches[i] || { name:'â€”', tag:'' };
    var d = dinners[i] || { name:'â€”', tag:'' };
    var lw = mealHasAllergen(l.name);
    var dw = mealHasAllergen(d.name);
    var card = document.createElement('div');
    card.className = 'day-card';
    var lData = JSON.stringify(l).replace(/'/g, '&#39;');
    var dData = JSON.stringify(d).replace(/'/g, '&#39;');
    card.innerHTML =
      '<div class="day-name">' + day + '</div>' +
      '<div class="day-meals">' +
        '<div class="meal-item lunch' + (lw?' has-warning':'') + '" data-idx="l' + i + '">' +
          '<div class="meal-label">â˜€ï¸ DÃ©jeuner</div>' +
          '<div class="meal-name">' + l.name + '</div>' +
          (l.tag ? '<div class="meal-theme-tag">' + l.tag + '</div>' : '') +
        '</div>' +
        '<div class="meal-item dinner' + (dw?' has-warning':'') + '" data-idx="d' + i + '">' +
          '<div class="meal-label">ğŸŒ™ DÃ®ner</div>' +
          '<div class="meal-name">' + d.name + '</div>' +
          (d.tag ? '<div class="meal-theme-tag">' + d.tag + '</div>' : '') +
        '</div>' +
      '</div>';
    card.querySelector('[data-idx="l' + i + '"]').addEventListener('click', function(){ openRecipe(l); });
    card.querySelector('[data-idx="d' + i + '"]').addEventListener('click', function(){ openRecipe(d); });
    dg.appendChild(card);
  });
}

// ============================================================
// COURSES
// ============================================================
function generateCourses(meals, persons) {
  var p = parseInt(persons) || 1;
  var c = {
    'ğŸ¥© Viandes & Poissons': [],
    'ğŸ¥¦ LÃ©gumes & Fruits': [],
    'ğŸ§€ CrÃ©merie': [],
    'ğŸŒ¾ Ã‰picerie & FÃ©culents': [],
    'ğŸ«™ Conserves & Sauces': [],
    'ğŸŒ¿ Herbes & Ã‰pices': []
  };
  var names = meals.map(function(m){ return m.name.toLowerCase(); });
  var qG = function(g){ return (g*p) + ' g'; };
  var qt = function(n,u){ return (n*p) + ' ' + u; };

  if (names.some(function(n){ return n.includes('poulet') || n.includes('dinde'); })) c['ğŸ¥© Viandes & Poissons'].push({name:'Filets de poulet/dinde',qty:qG(300)});
  if (names.some(function(n){ return n.includes('bÅ“uf') || n.includes('steak') || n.includes('smash'); })) c['ğŸ¥© Viandes & Poissons'].push({name:'BÅ“uf',qty:qG(200)});
  if (names.some(function(n){ return n.includes('saumon'); })) c['ğŸ¥© Viandes & Poissons'].push({name:'PavÃ©s de saumon',qty:qt(1,'pavÃ©/pers.')});
  if (names.some(function(n){ return n.includes('thon'); })) c['ğŸ¥© Viandes & Poissons'].push({name:'Thon en boÃ®te',qty:qt(1,'boÃ®te')});
  if (names.some(function(n){ return n.includes('crevettes') || n.includes('gambas'); })) c['ğŸ¥© Viandes & Poissons'].push({name:'Crevettes/Gambas',qty:qG(150)});
  if (names.some(function(n){ return n.includes('jambon'); })) c['ğŸ¥© Viandes & Poissons'].push({name:'Jambon blanc/cru',qty:qG(80)});
  if (names.some(function(n){ return n.includes('lardons'); })) c['ğŸ¥© Viandes & Poissons'].push({name:'Lardons fumÃ©s',qty:qG(100)});
  if (names.some(function(n){ return n.includes('agneau'); })) c['ğŸ¥© Viandes & Poissons'].push({name:'Agneau',qty:qG(250)});
  if (names.some(function(n){ return n.includes('saucisse') || n.includes('chorizo'); })) c['ğŸ¥© Viandes & Poissons'].push({name:'Saucisses/Chorizo',qty:qG(150)});
  if (names.some(function(n){ return n.includes('moules'); })) c['ğŸ¥© Viandes & Poissons'].push({name:'Moules fraÃ®ches',qty:qG(500)});

  if (names.some(function(n){ return n.includes('tomat'); })) c['ğŸ¥¦ LÃ©gumes & Fruits'].push({name:'Tomates',qty:qG(300)});
  if (names.some(function(n){ return n.includes('courgette'); })) c['ğŸ¥¦ LÃ©gumes & Fruits'].push({name:'Courgettes',qty:qt(2,'piÃ¨ces')});
  if (names.some(function(n){ return n.includes('champignon'); })) c['ğŸ¥¦ LÃ©gumes & Fruits'].push({name:'Champignons',qty:qG(200)});
  if (names.some(function(n){ return n.includes('Ã©pinard'); })) c['ğŸ¥¦ LÃ©gumes & Fruits'].push({name:'Ã‰pinards frais',qty:qG(150)});
  if (names.some(function(n){ return n.includes('avocat'); })) c['ğŸ¥¦ LÃ©gumes & Fruits'].push({name:'Avocats',qty:qt(1,'piÃ¨ce/pers.')});
  if (names.some(function(n){ return n.includes('pomme de terre') || n.includes('frites') || n.includes('gratin'); })) c['ğŸ¥¦ LÃ©gumes & Fruits'].push({name:'Pommes de terre',qty:qG(500)});
  if (names.some(function(n){ return n.includes('poivron'); })) c['ğŸ¥¦ LÃ©gumes & Fruits'].push({name:'Poivrons',qty:qt(2,'piÃ¨ces')});
  if (names.some(function(n){ return n.includes('carotte'); })) c['ğŸ¥¦ LÃ©gumes & Fruits'].push({name:'Carottes',qty:qt(3,'piÃ¨ces')});
  c['ğŸ¥¦ LÃ©gumes & Fruits'].push({name:'Oignons',qty:'1 filet'},{name:'Ail',qty:'1 tÃªte'},{name:'Citrons',qty:qt(2,'piÃ¨ces')});

  c['ğŸ§€ CrÃ©merie'].push({name:'Å’ufs',qty:qt(6,'piÃ¨ces')},{name:'Beurre',qty:'250 g'},{name:'CrÃ¨me fraÃ®che',qty:p<=2?'40 cl':'80 cl'},{name:'Lait',qty:p<=2?'1 L':'2 L'});
  if (names.some(function(n){ return n.includes('parmesan') || n.includes('risotto'); })) c['ğŸ§€ CrÃ©merie'].push({name:'Parmesan rÃ¢pÃ©',qty:qG(60)});
  if (names.some(function(n){ return n.includes('mozzarella') || n.includes('burrata'); })) c['ğŸ§€ CrÃ©merie'].push({name:'Mozzarella',qty:qt(1,'boule')});
  if (names.some(function(n){ return n.includes('feta'); })) c['ğŸ§€ CrÃ©merie'].push({name:'Feta',qty:qG(150)});
  if (names.some(function(n){ return n.includes('chÃ¨vre'); })) c['ğŸ§€ CrÃ©merie'].push({name:'BÃ»che de chÃ¨vre',qty:'1 bÃ»che'});
  if (names.some(function(n){ return n.includes('comtÃ©') || n.includes('gruyÃ¨re'); })) c['ğŸ§€ CrÃ©merie'].push({name:'Fromage Ã  gratiner',qty:qG(150)});
  if (names.some(function(n){ return n.includes('halloumi'); })) c['ğŸ§€ CrÃ©merie'].push({name:'Halloumi',qty:qG(250)});

  if (names.some(function(n){ return n.includes('riz'); })) c['ğŸŒ¾ Ã‰picerie & FÃ©culents'].push({name:'Riz',qty:qG(100)+'/repas'});
  if (names.some(function(n){ return n.includes('pÃ¢tes') || n.includes('spaghetti') || n.includes('penne'); })) c['ğŸŒ¾ Ã‰picerie & FÃ©culents'].push({name:'PÃ¢tes',qty:qG(100)+'/repas'});
  if (names.some(function(n){ return n.includes('ramen') || n.includes('soba') || n.includes('nouilles'); })) c['ğŸŒ¾ Ã‰picerie & FÃ©culents'].push({name:'Nouilles asiatiques',qty:qG(100)});
  if (names.some(function(n){ return n.includes('quinoa'); })) c['ğŸŒ¾ Ã‰picerie & FÃ©culents'].push({name:'Quinoa',qty:qG(100)});
  if (names.some(function(n){ return n.includes('lentille'); })) c['ğŸŒ¾ Ã‰picerie & FÃ©culents'].push({name:'Lentilles',qty:qG(120)});
  if (names.some(function(n){ return n.includes('pain') || n.includes('naan') || n.includes('pita'); })) c['ğŸŒ¾ Ã‰picerie & FÃ©culents'].push({name:'Pain/naan/pita',qty:'1 paquet'});
  if (names.some(function(n){ return n.includes('tortilla') || n.includes('tacos') || n.includes('wrap'); })) c['ğŸŒ¾ Ã‰picerie & FÃ©culents'].push({name:'Tortillas',qty:'1 paquet'});
  c['ğŸŒ¾ Ã‰picerie & FÃ©culents'].push({name:'Pain de campagne',qty:'1 miche'});

  if (names.some(function(n){ return n.includes('tomat'); })) c['ğŸ«™ Conserves & Sauces'].push({name:'Tomates pelÃ©es (boÃ®te)',qty:qt(2,'boÃ®tes')});
  if (names.some(function(n){ return n.includes('pois chiches') || n.includes('houmous'); })) c['ğŸ«™ Conserves & Sauces'].push({name:'Pois chiches (boÃ®te)',qty:qt(2,'boÃ®tes')});
  if (names.some(function(n){ return n.includes('coco') || n.includes('curry') || n.includes('thaÃ¯'); })) c['ğŸ«™ Conserves & Sauces'].push({name:'Lait de coco',qty:qt(2,'boÃ®tes')});
  if (names.some(function(n){ return n.includes('miso'); })) c['ğŸ«™ Conserves & Sauces'].push({name:'PÃ¢te miso',qty:'1 pot'});
  if (names.some(function(n){ return n.includes('soja') || n.includes('wok') || n.includes('teriyaki'); })) c['ğŸ«™ Conserves & Sauces'].push({name:'Sauce soja',qty:'1 bouteille'});
  c['ğŸ«™ Conserves & Sauces'].push({name:'Huile d\'olive',qty:'1 bouteille'},{name:'Bouillon',qty:'1 boÃ®te chaque'},{name:'Moutarde de Dijon',qty:'1 pot'});

  c['ğŸŒ¿ Herbes & Ã‰pices'].push({name:'Persil plat frais',qty:'1 bouquet'},{name:'Thym & laurier',qty:'1 bouquet'});
  if (names.some(function(n){ return n.includes('basilic'); })) c['ğŸŒ¿ Herbes & Ã‰pices'].push({name:'Basilic frais',qty:'1 pot'});
  if (names.some(function(n){ return n.includes('coriandre'); })) c['ğŸŒ¿ Herbes & Ã‰pices'].push({name:'Coriandre fraÃ®che',qty:'1 bouquet'});
  if (names.some(function(n){ return n.includes('curry') || n.includes('dhal'); })) c['ğŸŒ¿ Herbes & Ã‰pices'].push({name:'Curry/Garam masala',qty:'1 pot'});
  if (names.some(function(n){ return n.includes('gingembre'); })) c['ğŸŒ¿ Herbes & Ã‰pices'].push({name:'Gingembre frais',qty:'1 morceau'});
  c['ğŸŒ¿ Herbes & Ã‰pices'].push({name:'Fleur de sel & poivre noir',qty:'selon besoin'});

  return c;
}

function renderCourses(courses) {
  var g = document.getElementById('coursesGrid');
  g.innerHTML = '';
  Object.entries(courses).forEach(function(entry) {
    var cat = entry[0], items = entry[1];
    if (!items.length) return;
    var div = document.createElement('div');
    div.className = 'course-category';
    div.innerHTML = '<div class="cat-title">' + cat + '</div>' +
      items.map(function(i){ return '<div class="course-item"><span class="course-name">' + i.name + '</span><span class="course-qty">' + i.qty + '</span></div>'; }).join('');
    g.appendChild(div);
  });
}

// ============================================================
// RECIPE MODAL
// ============================================================
function openRecipe(meal) {
  var rec = RECIPE_DB[meal.name];
  var p = parseInt(document.getElementById('nbPersonnes').value) || 1;
  var isGeneric = !rec;
  if (!rec) {
    rec = {
      temps:'30 min', difficulte:'Moyen',
      baseIngredients:[{name:'IngrÃ©dients principaux',q:null,u:'selon recette'}],
      steps:['PrÃ©parer les ingrÃ©dients.','Cuire selon la mÃ©thode adaptÃ©e.','Assaisonner et servir chaud.'],
      tip:'GoÃ»tez et ajustez l\'assaisonnement en fin de cuisson.'
    };
  }
  var hw = mealHasAllergen(meal.name);
  var an = Array.from(activeAllergies).map(function(a){ var f = ALLERGIES.find(function(x){ return x.id===a; }); return f ? f.label : ''; }).filter(Boolean);

  document.getElementById('modalTag').textContent = (meal.tag || '') + ' Â· Recette';
  document.getElementById('modalTitle').textContent = meal.name;
  document.getElementById('modalMeta').innerHTML = '<span>â±ï¸ ' + rec.temps + '</span><span>ğŸ‘¨â€ğŸ³ ' + rec.difficulte + '</span><span>ğŸ½ï¸ ' + p + ' pers.</span>';

  var ings = rec.baseIngredients.map(function(ing) {
    if (ing.q === null) return { name:ing.name, qty:ing.u };
    return { name:ing.name, qty:parseFloat((ing.q*p).toFixed(1)) + ' ' + ing.u };
  });

  var body = '';
  if (p > 1) body += '<div class="modal-note">ğŸ‘¥ QuantitÃ©s pour <strong>' + p + ' personnes</strong></div>';
  if (hw) body += '<div class="modal-note warning">âš ï¸ Peut contenir : <strong>' + an.join(', ') + '</strong></div>';
  if (isGeneric) body += '<div class="modal-note" style="background:#EEF2EC;border-color:#7A8C6E;color:#3D4F33;">ğŸ’¡ Recette en cours d\'enrichissement</div>';
  body += '<div class="recipe-section-title">IngrÃ©dients</div>';
  body += '<div class="ingredients-grid">' + ings.map(function(i){ return '<div class="ingredient-row"><span>' + i.name + '</span><span class="ingredient-qty">' + i.qty + '</span></div>'; }).join('') + '</div>';
  body += '<div class="recipe-section-title">PrÃ©paration</div>';
  body += '<div class="steps-list">' + rec.steps.map(function(s,i){ return '<div class="step"><div class="step-num">' + (i+1) + '</div><div class="step-text">' + s + '</div></div>'; }).join('') + '</div>';
  if (rec.tip) body += '<div class="chef-tip"><strong>ğŸ’¡ Astuce du chef</strong>' + rec.tip + '</div>';

  document.getElementById('modalBody').innerHTML = body;
  document.getElementById('recipeOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeRecipe() {
  document.getElementById('recipeOverlay').classList.remove('open');
  document.body.style.overflow = '';
}

// ============================================================
// SHARE
// ============================================================
function buildShareText() {
  var p = document.getElementById('nbPersonnes').value;
  var t = 'ğŸ½ï¸ KESKONMANJ â€” Ma semaine (' + p + ' pers.)\n\n';
  DAYS.forEach(function(d, i) {
    t += d + ': ' + (currentLunches[i] ? currentLunches[i].name : 'â€”') + ' / ' + (currentDinners[i] ? currentDinners[i].name : 'â€”') + '\n';
  });
  t += '\nğŸ›’ COURSES :\n';
  Object.entries(currentCourses).forEach(function(entry) {
    var cat = entry[0], items = entry[1];
    if (!items.length) return;
    t += '\n' + cat + '\n';
    items.forEach(function(i){ t += 'â˜ ' + i.name + ' â€” ' + i.qty + '\n'; });
  });
  t += '\nâ€” GÃ©nÃ©rÃ© avec Keskonmanj by fluide.cmpny';
  return t;
}

function openShare() {
  if (!currentLunches.length) { showToast('âš ï¸ GÃ©nÃ¨re d\'abord une semaine !'); return; }
  var txt = buildShareText();
  document.getElementById('shareCopyInput').value = txt.substring(0, 80) + 'â€¦';
  document.getElementById('shareOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeShare() {
  document.getElementById('shareOverlay').classList.remove('open');
  document.body.style.overflow = '';
}

function doShare(channel) {
  var txt = buildShareText();
  var enc = encodeURIComponent(txt);
  closeShare();
  if (channel === 'whatsapp') window.open('https://api.whatsapp.com/send?text=' + enc, '_blank');
  else if (channel === 'sms') window.open('sms:?body=' + enc, '_blank');
  else if (channel === 'email') window.open('mailto:?subject=' + encodeURIComponent('ğŸ½ï¸ Ma semaine Keskonmanj') + '&body=' + enc, '_blank');
  else if (channel === 'telegram') window.open('https://t.me/share/url?url=https://fluide.cmpny&text=' + enc, '_blank');
  else if (channel === 'native') {
    if (navigator.share) {
      navigator.share({ title:'Keskonmanj', text:txt }).catch(function(){});
    } else {
      navigator.clipboard.writeText(txt).then(function(){ showToast('ğŸ“‹ CopiÃ© !'); }).catch(function(){
        showToast('ğŸ“‹ Copie manuelle depuis le champ');
      });
    }
  }
  else if (channel === 'print') window.print();
}

// ============================================================
// SAVE / RESTORE â€” Safari-safe
// ============================================================
function saveWeek() {
  if (!currentLunches.length) return;
  var data = {
    savedAt: new Date().toLocaleDateString('fr-FR', { weekday:'long', day:'numeric', month:'long' }),
    lunches: currentLunches, dinners: currentDinners,
    themes: Array.from(selectedThemes),
    persons: document.getElementById('nbPersonnes').value,
    allergies: Array.from(activeAllergies)
  };
  Storage.set('keskonmanj', JSON.stringify(data));
  document.getElementById('saveBadge').classList.add('visible');
  document.getElementById('savedBanner').classList.add('visible');
  showToast('âœ… Semaine sauvegardÃ©e !');
}

function restoreWeek() {
  var raw = Storage.get('keskonmanj');
  if (!raw) { showToast('Aucune sauvegarde trouvÃ©e'); return; }
  var data;
  try { data = JSON.parse(raw); } catch(e) { showToast('Erreur de sauvegarde'); return; }
  currentLunches = data.lunches;
  currentDinners = data.dinners;
  selectedThemes = new Set(data.themes || []);
  document.querySelectorAll('.theme-btn').forEach(function(btn, i) {
    btn.classList.toggle('selected', selectedThemes.has(THEMES[i] && THEMES[i].id));
  });
  if (data.persons) document.getElementById('nbPersonnes').value = data.persons;
  if (data.allergies) {
    activeAllergies = new Set(data.allergies);
    document.querySelectorAll('.allergy-btn').forEach(function(btn, i) {
      btn.classList.toggle('active', activeAllergies.has(ALLERGIES[i] && ALLERGIES[i].id));
    });
  }
  var c = selectedThemes.size;
  document.getElementById('selectedCount').innerHTML = '<strong>' + c + '</strong> thÃ¨me(s) â€” choisis entre 2 et 4';
  document.getElementById('btnGenerate').disabled = c < 2;
  renderWeek(currentLunches, currentDinners);
  currentCourses = generateCourses(currentLunches.concat(currentDinners), data.persons || 2);
  renderCourses(currentCourses);
  document.getElementById('saveBadge').classList.add('visible');
  document.getElementById('results').classList.add('visible');
  document.getElementById('results').scrollIntoView({ behavior:'smooth', block:'start' });
  showToast('ğŸ”„ Semaine restaurÃ©e !');
}

function clearSave() {
  if (!confirm('Effacer la sauvegarde ?')) return;
  Storage.remove('keskonmanj');
  document.getElementById('saveBadge').classList.remove('visible');
  document.getElementById('savedBanner').classList.remove('visible');
  showToast('ğŸ—‘ï¸ Sauvegarde effacÃ©e');
}

// ============================================================
// INIT & EVENTS
// ============================================================
renderAllergies();
renderThemes();

// Check saved
if (Storage.get('keskonmanj')) document.getElementById('savedBanner').classList.add('visible');

// Buttons
document.getElementById('btnGenerate').addEventListener('click', generate);
document.getElementById('btnSave').addEventListener('click', saveWeek);
document.getElementById('btnShare').addEventListener('click', openShare);
document.getElementById('btnPrint').addEventListener('click', function(){ window.print(); });
document.getElementById('btnClear').addEventListener('click', clearSave);
document.getElementById('btnRestore').addEventListener('click', restoreWeek);

// Recipe modal
document.getElementById('btnCloseRecipe').addEventListener('click', closeRecipe);
document.getElementById('recipeOverlay').addEventListener('click', function(e){
  if (e.target === document.getElementById('recipeOverlay')) closeRecipe();
});

// Share modal
document.getElementById('btnCloseShare').addEventListener('click', closeShare);
document.getElementById('shareOverlay').addEventListener('click', function(e){
  if (!document.getElementById('shareSheet').contains(e.target)) closeShare();
});
document.getElementById('sWhatsapp').addEventListener('click', function(){ doShare('whatsapp'); });
document.getElementById('sSms').addEventListener('click', function(){ doShare('sms'); });
document.getElementById('sEmail').addEventListener('click', function(){ doShare('email'); });
document.getElementById('sTelegram').addEventListener('click', function(){ doShare('telegram'); });
document.getElementById('sNative').addEventListener('click', function(){ doShare('native'); });
document.getElementById('sPrint').addEventListener('click', function(){ doShare('print'); });
document.getElementById('sCopy').addEventListener('click', function(){
  var txt = buildShareText();
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(txt).then(function(){ showToast('ğŸ“‹ Liste copiÃ©e !'); }).catch(function(){
      // Fallback for Safari restrictions
      var ta = document.createElement('textarea');
      ta.value = txt; ta.style.position='fixed'; ta.style.opacity='0';
      document.body.appendChild(ta); ta.focus(); ta.select();
      try { document.execCommand('copy'); showToast('ğŸ“‹ Liste copiÃ©e !'); } catch(e) { showToast('SÃ©lectionne le texte manuellement'); }
      document.body.removeChild(ta);
    });
  } else {
    var ta = document.createElement('textarea');
    ta.value = txt; ta.style.position='fixed'; ta.style.opacity='0';
    document.body.appendChild(ta); ta.focus(); ta.select();
    try { document.execCommand('copy'); showToast('ğŸ“‹ Liste copiÃ©e !'); } catch(e) {}
    document.body.removeChild(ta);
  }
});

// Keyboard
document.addEventListener('keydown', function(e){
  if (e.key === 'Escape') { closeRecipe(); closeShare(); }
});

// iOS: prevent double-tap zoom â€” uniquement sur les Ã©lÃ©ments non-interactifs
document.addEventListener('touchend', function(e){
  var tag = e.target.tagName;
  if (tag !== 'BUTTON' && tag !== 'SELECT' && tag !== 'INPUT' && tag !== 'LABEL') {
    // ne rien faire
  }
}, { passive:true });
</script>
</body>
</html>
